<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<AnchorPane prefHeight="560.0" prefWidth="900.0"
            style="-fx-background-color: #f6f8ff;"
            xmlns="http://javafx.com/javafx/24.0.1"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="controllers.BorrowingController">

  <children>
    <ScrollPane fitToWidth="true" fitToHeight="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED"
                AnchorPane.topAnchor="0.0" AnchorPane.bottomAnchor="0.0"
                AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">
      <content>
        <VBox spacing="18.0">
          <padding>
            <Insets top="20.0" right="20.0" bottom="20.0" left="20.0"/>
          </padding>

          <!-- Back -->
          <Button onAction="#handleBackToDashboard"
                  style="-fx-background-color:#e9efff; -fx-text-fill:#3f5fa8; -fx-font-weight:bold;
                         -fx-background-radius:14; -fx-padding:6 14; -fx-border-color:#d7e4ff;
                         -fx-border-radius:14; -fx-border-width:1;"
                  text="← Dashboard"/>

          <!-- Title -->
          <Label style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #3f5fa8;"
                 text="Borrow Book"/>

          <!-- ===== عمودين: يسار (الفورم) + يمين (الهيستوري) ===== -->
          <HBox spacing="16.0">
            <children>

              <!-- ===== العمود الأيسر: بطاقة الفورم ===== -->
              <VBox maxWidth="720.0" spacing="16.0"
                    style="-fx-background-color: white; -fx-background-radius: 18;
                           -fx-border-radius: 18; -fx-border-color: #e3ebff;">
                <padding>
                  <Insets top="20.0" right="20.0" bottom="20.0" left="20.0"/>
                </padding>

                <children>
                  <Label style="-fx-text-fill: #8aa0c8; -fx-font-size: 12.5;"
                         text="Please fill the form to record a new borrowing." />

                  <GridPane hgap="12.0" vgap="12.0">
                    <columnConstraints>
                      <ColumnConstraints percentWidth="30.0"/>
                      <ColumnConstraints percentWidth="70.0"/>
                    </columnConstraints>

                    <children>
                      <Label style="-fx-text-fill:#41506a;" text="Select Book"
                             GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                      <ComboBox fx:id="bookCombo" promptText="Choose available book"
                                style="-fx-background-radius:12; -fx-border-radius:12; -fx-border-color:#cfe0ff; -fx-padding:8;"
                                GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                      <Label style="-fx-text-fill:#41506a;" text="Select Member"
                             GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                      <ComboBox fx:id="memberCombo" promptText="Choose member"
                                style="-fx-background-radius:12; -fx-border-radius:12; -fx-border-color:#cfe0ff; -fx-padding:8;"
                                GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                      <Label style="-fx-text-fill:#41506a;" text="Borrow Date"
                             GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                      <DatePicker fx:id="borrowDate" promptText="Select borrow date"
                                  style="-fx-background-radius:12; -fx-border-radius:12; -fx-border-color:#cfe0ff; -fx-padding:8;"
                                  GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                    </children>

                    <rowConstraints>
                      <RowConstraints/><RowConstraints/><RowConstraints/>
                    </rowConstraints>
                  </GridPane>

                  <Button fx:id="borrowBtn" defaultButton="true" onAction="#handleBorrow"
                          style="-fx-background-color:#3f5fa8; -fx-text-fill:white;
                                 -fx-font-weight:bold; -fx-background-radius:14; -fx-padding:10 14;"
                          text="Borrow Book"/>

                  <HBox spacing="30.0">
                    <children>
                      <VBox spacing="20.0">
                        <children>
                          <TextField fx:id="textSearchFeild" promptText="Enter Member ID or book title"/>
                          <DatePicker fx:id="searchByDatePicker" promptText="Choose date to search"/>
                        </children>
                      </VBox>

                      <VBox spacing="20.0">
                        <children>
                          <Button fx:id="searchbtn" onAction="#handleSearchButton"
                                  style="-fx-background-color: #3f5fa8; -fx-text-fill: white;
                                         -fx-font-weight: bold; -fx-background-radius: 14; -fx-padding: 10 14;"
                                  text="Search"/>
                          <Button fx:id="resetbtn" onAction="#handleResetBtn"
                                  style="-fx-background-color: red; -fx-text-fill: white;
                                         -fx-font-weight: bold; -fx-background-radius: 14; -fx-padding: 10 14;"
                                  text="RESET"/>
                        </children>
                      </VBox>

                      <ComboBox fx:id="sortComboBox" promptText="SORT ME BY"/>
                    </children>
                  </HBox>

                  <Label style="-fx-text-fill:#9fb0d6; -fx-font-size:11;"
                         text="Only available books are listed. Future dates are not allowed."/>
                </children>
              </VBox>

              <!-- ===== العمود الأيمن: بطاقة الهيستوري ===== -->
              <VBox maxWidth="860.0" spacing="10.0"
                    style="-fx-background-color: white; -fx-background-radius: 18;
                           -fx-border-radius: 18; -fx-border-color: #e3ebff;"
                    HBox.hgrow="ALWAYS">
                <padding>
                  <Insets top="16.0" right="16.0" bottom="16.0" left="16.0"/>
                </padding>
                <children>

                  <Label style="-fx-text-fill:#41506a; -fx-font-weight:bold; -fx-font-size:14;"
                         text="Borrowing History"/>

                  <!-- Mark as Returned بالأعلى يمين -->
                  <HBox alignment="CENTER_RIGHT">
                    <children>
                      <Button fx:id="markReturnedBtn" onAction="#handleMarkReturned"
                              style="-fx-background-color:green; -fx-text-fill:white;
                                     -fx-font-weight:bold; -fx-background-radius:12; -fx-padding:8 14;"
                              text="Mark as Returned"/>
                    </children>
                  </HBox>

                  <!-- TableView بسكرول داخلي -->
                  <TableView fx:id="historyTable"
                             prefHeight="360.0"
                             fixedCellSize="28.0"
                             tableMenuButtonVisible="true"
                             VBox.vgrow="ALWAYS"
                             style="-fx-background-radius:12; -fx-border-radius:12; -fx-border-color:#eef3ff; -fx-font-size:12.5;">
                    <!-- سكرول أفقي عند الحاجة -->
                    <columnResizePolicy>
                      <TableView fx:constant="UNCONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>

                    <columns>
                      <TableColumn fx:id="hIdCol"     prefWidth="80"  text="ID"/>
                      <TableColumn fx:id="hBookCol"   prefWidth="240" text="Book"/>
                      <TableColumn fx:id="hMemberCol" prefWidth="200" text="Member"/>
                      <TableColumn fx:id="hDateCol"   prefWidth="140" text="Borrow Date"/>
                      <TableColumn fx:id="hReturnCol" prefWidth="140" text="Return Date"/>
                    </columns>

                    <placeholder>
                      <Label style="-fx-text-fill:#9fb0d6;" text="No borrowings yet"/>
                    </placeholder>
                  </TableView>

                  <!-- حالة المهمة -->
                  <Label fx:id="statusBorrow" text=""/>

                  <!-- مخرجات/لوج -->
                  <TextArea fx:id="outputBorrow"
                            promptText="Output will appear here (reminders, fines, logs)..."
                            editable="false" wrapText="true" prefRowCount="6"/>

                  <!-- أزرار التنبيهات/الحساب تحت + المؤشّر -->
                  <HBox spacing="8">
                    <Button fx:id="btnRefreshHistory" text="Refresh History" onAction="#handleRefreshHistory"/>
                    <Button fx:id="btnGenerateReminders" text="Generate Reminders" onAction="#handleGenerateReminders"/>
                    <Button fx:id="btnCalculateFines" text="Calculate Fines" onAction="#handleCalculateFines"/>
                    <Button fx:id="btnCancelTask" text="Cancel" onAction="#handleCancelBorrowTask" visible="false"/>
                    <ProgressIndicator fx:id="progressBorrow" visible="false" prefWidth="22" prefHeight="22"/>
                  </HBox>

                </children>
              </VBox>

            </children>
          </HBox>
          <!-- ===== نهاية العمودين ===== -->

        </VBox>
      </content>
    </ScrollPane>
  </children>
</AnchorPane>
